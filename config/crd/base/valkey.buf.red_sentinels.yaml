---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.15.0
  name: sentinels.valkey.buf.red
spec:
  group: valkey.buf.red
  names:
    kind: Sentinel
    listKind: SentinelList
    plural: sentinels
    singular: sentinel
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - description: Sentinel replicas
      jsonPath: .spec.replicas
      name: Replicas
      type: integer
    - description: Instance access type
      jsonPath: .spec.access.type
      name: Access
      type: string
    - description: Instance phase
      jsonPath: .status.phase
      name: Status
      type: string
    - description: Instance status message
      jsonPath: .status.message
      name: Message
      type: string
    - description: Time since creation
      jsonPath: .metadata.creationTimestamp
      name: Age
      type: date
    name: v1alpha1
    schema:
      openAPIV3Schema:
        description: Sentinel is the Schema for the sentinels API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: SentinelSpec defines the desired state of Sentinel
            properties:
              access:
                description: Access the access for sentinel
                properties:
                  annotations:
                    additionalProperties:
                      type: string
                    description: The annnotations of the service which will be attached
                      to services
                    type: object
                  certIssuer:
                    description: Cert Issuer for external access TLS certificate
                    type: string
                  certIssuerType:
                    default: ClusterIssuer
                    description: Cert Issuer Type for external access TLS certificate
                    enum:
                    - ClusterIssuer
                    - Issuer
                    type: string
                  defaultPasswordSecret:
                    description: |-
                      DefaultPasswordSecret referered to the secret which defined the password for default user
                      The referered secret must have `password` key whose value matching regex: ^[a-zA-Z0-9_!@#$%^&*()-_=+?]{8,128}$
                    type: string
                  enableTLS:
                    description: EnableTLS enable TLS for external access
                    type: boolean
                  externalTLSSecret:
                    description: ExternalTLSSecret the external TLS secret to use,
                      if not provided, the operator will issue one
                    type: string
                  ipFamilyPrefer:
                    $ref: '#/definitions/k8s.io~1api~1core~1v1~0IPFamily'
                    description: |-
                      IPFamily represents the IP Family (IPv4 or IPv6).
                      This type is used to express the family of an IP expressed by a type (e.g. service.spec.ipFamilies).
                    enum:
                    - IPv4
                    - IPv6
                  ports:
                    description: Ports defines the nodeports of NodePort service
                    pattern: ^([0-9]+:[0-9]+)(,[0-9]+:[0-9]+)*$
                    type: string
                  type:
                    $ref: '#/definitions/k8s.io~1api~1core~1v1~0ServiceType'
                    default: ClusterIP
                    description: ServiceType defines the type of the all related services
                    enum:
                    - NodePort
                    - LoadBalancer
                    - ClusterIP
                type: object
              affinity:
                $ref: '#/definitions/k8s.io~1api~1core~1v1~0Affinity'
                description: Affinity
              customConfigs:
                additionalProperties:
                  type: string
                description: CustomConfigs the config for sentinel
                type: object
              exporter:
                description: Exporter defines the specification for the sentinel exporter
                properties:
                  enabled:
                    description: Enabled enable the exporter
                    type: boolean
                  image:
                    description: Image the exporter image
                    type: string
                  imagePullPolicy:
                    $ref: '#/definitions/k8s.io~1api~1core~1v1~0PullPolicy'
                    description: ImagePullPolicy
                  resources:
                    $ref: '#/definitions/k8s.io~1api~1core~1v1~0ResourceRequirements'
                    description: Resources for setting resource requirements for the
                      Pod Resources *v1.ResourceRequirements
                type: object
              image:
                description: Image the valkey sentinel image
                type: string
              imagePullPolicy:
                $ref: '#/definitions/k8s.io~1api~1core~1v1~0PullPolicy'
                description: ImagePullPolicy the image pull policy
              imagePullSecrets:
                description: ImagePullSecrets the image pull secrets
                items:
                  $ref: '#/definitions/k8s.io~1api~1core~1v1~0LocalObjectReference'
                type: array
              nodeSelector:
                additionalProperties:
                  type: string
                description: NodeSelector
                type: object
              podAnnotations:
                additionalProperties:
                  type: string
                description: PodAnnotations
                type: object
              replicas:
                description: Replicas the number of sentinel replicas
                format: int32
                minimum: 3
                type: integer
              resources:
                $ref: '#/definitions/k8s.io~1api~1core~1v1~0ResourceRequirements'
                description: Resources the resources for sentinel
              securityContext:
                $ref: '#/definitions/k8s.io~1api~1core~1v1~0PodSecurityContext'
                description: SecurityContext
              tolerations:
                description: Tolerations
                items:
                  $ref: '#/definitions/k8s.io~1api~1core~1v1~0Toleration'
                type: array
            type: object
          status:
            description: SentinelStatus defines the observed state of Sentinel
            properties:
              message:
                description: Message the status message
                type: string
              nodes:
                description: Nodes the valkey node details
                items:
                  description: ValkeyNode represent a ValkeyCluster Node
                  properties:
                    id:
                      description: ID is the valkey cluster node id, not runid
                      type: string
                    ip:
                      description: IP is the ip of the node. if access announce is
                        enabled, it will be the access ip
                      type: string
                    masterRef:
                      description: MasterRef is the master node id of this node
                      type: string
                    nodeName:
                      description: NodeName is the node name of the node where holds
                        the pod
                      type: string
                    podName:
                      description: PodName current pod name
                      type: string
                    port:
                      description: Port is the port of the node. if access announce
                        is enabled, it will be the access port
                      type: string
                    role:
                      description: Role is the role of the node, master or slave
                      type: string
                    shardId:
                      description: ShardID cluster shard id of the node
                      type: string
                    slots:
                      description: 'Slots is the slot range for the shard, eg: 0-1000,1002,1005-1100'
                      type: string
                    statefulSet:
                      description: StatefulSet is the statefulset name of this pod
                      type: string
                  required:
                  - ip
                  - nodeName
                  - podName
                  - port
                  - role
                  - statefulSet
                  type: object
                type: array
              phase:
                description: Phase the status phase
                type: string
              tlsSecret:
                description: TLSSecret the tls secret
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
